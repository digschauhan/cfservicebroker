---
name: apigee-cf-service-broker
label: Apigee
description: POC service broker for Apigee Edge
icon_image: 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
product_version: '0.1.10'
metadata_version: '1.5'
rank: 1
serial: true

releases:
- file: apigee-cf-service-broker-0.1.10.tgz
  name: apigee-cf-service-broker
  version: '0.1.10'

stemcell_criteria:
  os: ubuntu-trusty
  requires_cpi: false
  version: '3146'

property_blueprints:
#
# Parameters for the entire product
#
- name: org
  type: string
  configurable: true
  default: apigee-cf-service-broker-org
- name: org_quota
  type: integer
  configurable: true
  constraints:
    min: 512
    max: 4096
  default: 2048
- name: space
  type: string
  configurable: true
  default: apigee-cf-service-broker-space
- name: apply_open_security_group
  type: boolean
  configurable: true
  default: False
- name: allow_paid_service_plans
  type: boolean
  configurable: true
  default: False
#
# Standard properties for package apigee_cf_service_broker
#
- name: apigee_cf_service_broker_enable_global_access_to_plans
  type: boolean
  configurable: true
  default: True
#
# Custom properties from the tile.yml file
#
- name: apigee_redis_passphrase # Refer to this elsewhere as (( .properties.apigee_redis_passphrase ))
  type: string
  default: secret
  configurable: true
- name: apigee_dashboard_url # Refer to this elsewhere as (( .properties.apigee_dashboard_url ))
  type: string
  default: https://enterprise.apigee.com/platform/#/
  configurable: true
- name: apigee_proxy_host # Refer to this elsewhere as (( .properties.apigee_proxy_host ))
  type: string
  default: apigee.net
  configurable: true
- name: apigee_mgmt_api_url # Refer to this elsewhere as (( .properties.apigee_mgmt_api_url ))
  type: string
  default: https://api.enterprise.apigee.com/v1
  configurable: true

form_types:
#
# Custom form apigee-form from the tile.yml file
#
- name: apigee-form
  label: Apigee Edge Tile
  description: Custom Properties for Apigee Edge
  property_inputs:
  - reference: .properties.apigee_redis_passphrase
    label: Broker Passphrase
    description: Passphrase used to encrypt redis datastore
  - reference: .properties.apigee_dashboard_url
    label: Dashboard URL
    description: URL to Apigee dashboard
  - reference: .properties.apigee_proxy_host
    label: Apigee Proxy Host
    description: Domain of Apigee proxy host
  - reference: .properties.apigee_mgmt_api_url
    label: Apigee Management API URL
    description: URL to the Apigee management API
#
# Service access form
#
- name: service_access
  label: Service Access
  description: Determine availability of services
  property_inputs:
  - reference: .properties.apigee_cf_service_broker_enable_global_access_to_plans
    label: Enable global access to plans of service apigee_cf_service_broker
    description: "Enable global access to plans in the marketplace"

job_types:
#
# Default compilation job
#
- name: compilation
  resource_label: compilation
  resource_definitions:
   - name: ram
     type: integer
     configurable: true
     default: 4096
   - name: ephemeral_disk
     type: integer
     configurable: true
     default: 10240
   - name: persistent_disk
     type: integer
     configurable: true
     default: 0
   - name: cpu
     type: integer
     configurable: true
     default: 2
  static_ip: 0
  dynamic_ip: 1
  max_in_flight: 1
  instance_definitions:
    - name: instances
      type: integer
      default: 1
#
# deploy-all job
#
- name: deploy-all
  resource_label: deploy-all
  errand: true
  templates:
  - name: deploy-all
    release: apigee-cf-service-broker
  resource_definitions:
  - name: ram
    type: integer
    configurable: false
    default: 1024
  - name: ephemeral_disk
    type: integer
    configurable: false
    default: 4096
  - name: persistent_disk
    type: integer
    configurable: false
    default: 0
  - name: cpu
    type: integer
    configurable: false
    default: 1
  static_ip: 0
  dynamic_ip: 1
  max_in_flight: 1
  instance_definitions:
  - name: instances
    type: integer
    configurable: false
    default: 1
  property_blueprints:
  - name: vm_credentials
    type: salted_credentials
    default:
      identity: vcap
  - name: app_credentials
    type: salted_credentials
  manifest: |
    domain: (( ..cf.cloud_controller.system_domain.value ))
    app_domains:
    - (( ..cf.cloud_controller.apps_domain.value ))
    org: (( .properties.org.value ))
    space: (( .properties.space.value ))
    ssl:
      skip_cert_verify: (( ..cf.ha_proxy.skip_cert_verify.value ))
    cf:
      admin_user: (( ..cf.uaa.system_services_credentials.identity ))
      admin_password: (( ..cf.uaa.system_services_credentials.password ))
    org_quota: (( .properties.org_quota.value ))
    apply_open_security_group: (( .properties.apply_open_security_group.value ))
    allow_paid_service_plans: (( .properties.allow_paid_service_plans.value ))
    security:
      user: (( .deploy-all.app_credentials.identity ))
      password: (( .deploy-all.app_credentials.password ))
    apigee_redis_passphrase: (( .properties.apigee_redis_passphrase.value ))
    apigee_dashboard_url: (( .properties.apigee_dashboard_url.value ))
    apigee_proxy_host: (( .properties.apigee_proxy_host.value ))
    apigee_mgmt_api_url: (( .properties.apigee_mgmt_api_url.value ))
    apigee_cf_service_broker:
      name: apigee_cf_service_broker
      user: (( .deploy-all.app_credentials.identity ))
      password: (( .deploy-all.app_credentials.password ))
      enable_global_access_to_plans: (( .properties.apigee_cf_service_broker_enable_global_access_to_plans.value ))
#
# delete-all job
#
- name: delete-all
  resource_label: delete-all
  errand: true
  templates:
  - name: delete-all
    release: apigee-cf-service-broker
  resource_definitions:
  - name: ram
    type: integer
    configurable: false
    default: 1024
  - name: ephemeral_disk
    type: integer
    configurable: false
    default: 4096
  - name: persistent_disk
    type: integer
    configurable: false
    default: 0
  - name: cpu
    type: integer
    configurable: false
    default: 1
  static_ip: 0
  dynamic_ip: 1
  max_in_flight: 1
  instance_definitions:
  - name: instances
    type: integer
    configurable: false
    default: 1
  property_blueprints:
  - name: vm_credentials
    type: salted_credentials
    default:
      identity: vcap
  - name: app_credentials
    type: salted_credentials
  manifest: |
    domain: (( ..cf.cloud_controller.system_domain.value ))
    app_domains:
    - (( ..cf.cloud_controller.apps_domain.value ))
    org: (( .properties.org.value ))
    space: (( .properties.space.value ))
    ssl:
      skip_cert_verify: (( ..cf.ha_proxy.skip_cert_verify.value ))
    cf:
      admin_user: (( ..cf.uaa.system_services_credentials.identity ))
      admin_password: (( ..cf.uaa.system_services_credentials.password ))

post_deploy_errands:
- name: deploy-all

pre_delete_errands:
- name: delete-all

update:
  canaries: 1
  canary_watch_time: 10000-100000
  max_in_flight: 1
  update_watch_time: 10000-100000

requires_product_versions:
- name: cf
  version: '~> 1.5'

provides_product_versions:
- name: apigee-cf-service-broker
  version: '0.1.10'